---
import Layout from "../layouts/Layout.astro";
---

<Layout title="RSVP">
  <div class="rsvp-wrapper">
    <h1>RSVP</h1>
    <p class="rsvp-intro">
      Either you or your partner can submit/update this. You'll both see the same details.
    </p>

    <div id="statusBox" class="status-box hidden" role="status" aria-live="polite">
      <p id="statusText"></p>
    </div>

    <form id="rsvpForm" class="rsvp-form hidden">
      <p class="rsvp-tip">
        Tip: your partner may also be editing this. If you both save at the same time,
        you might need to refresh and try again.
      </p>

      <div id="membersContainer"></div>

      <label class="field">
        <span class="field-label">Additional members of your party (children, etc.)</span>
        <input
          id="party_size"
          class="field-input"
          type="number"
          min="0"
          step="1"
          required
        />
      </label>

      <div id="additionalGuestFields" class="hidden">
        <label class="field">
          <span class="field-label">Names of additional guests</span>
          <input
            id="additional_guest_names"
            class="field-input"
            type="text"
            placeholder="e.g. Sophie (age 4), James"
          />
        </label>

        <label class="field" style="margin-top: 1rem;">
          <span class="field-label">Additional details / dietary requirements</span>
          <textarea
            id="additional_guest_details"
            class="field-input"
            rows="2"
            placeholder="e.g. highchair needed, nut allergy"
          ></textarea>
        </label>
      </div>

      <div class="button-group">
        <button id="saveBtn" class="nav-button" type="submit">
          Save RSVP
        </button>
        <button id="refreshBtn" class="nav-button" type="button">
          Refresh latest
        </button>
        <button id="signOutBtn" class="nav-button" type="button">
          Sign out
        </button>
      </div>

      <p id="meta" class="rsvp-meta"></p>
    </form>

    <div id="exploreNudge" class="explore-nudge hidden">
      <p>Now that you're all set, why not take a look around?</p>
      <div class="explore-links">
        <a href="/">Welcome / Homepage</a>
        <a href="/the-day">The Day</a>
        <a href="/schedule">Schedule</a>
        <a href="/faqs">FAQs</a>
      </div>
    </div>

    <div class="explore-subtle">
      <p>There's more to explore on the site:</p>
      <div class="explore-links">
        <a href="/">Welcome / Homepage</a>
        <a href="/the-day">The Day</a>
        <a href="/schedule">Schedule</a>
        <a href="/faqs">FAQs</a>
      </div>
    </div>
  </div>

  <script>
    import { initRsvp } from "../lib/rsvp";
    initRsvp();
  </script>
</Layout>

<style>
  .hidden { display: none; }

  .rsvp-wrapper {
    max-width: 40rem;
    margin: 0 auto;
  }

  .rsvp-intro {
    margin-top: 0.5rem;
  }

  .rsvp-tip {
    font-size: 0.85rem;
    color: var(--color-heading);
    opacity: 0.8;
  }

  .status-box {
    margin-top: 1.5rem;
    padding: 0.75rem 1rem;
    border: 1px solid var(--color-highlight);
    border-radius: 0.5rem;
    background: hsla(340, 60%, 75%, 0.08);
  }

  .rsvp-form {
    margin-top: 2rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .field {
    display: block;
  }

  .field-label {
    display: block;
    margin-bottom: 0.35rem;
    font-family: "Lanenar", sans-serif;
  }

  .field-input {
    width: 100%;
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--color-border);
    border-radius: 0.5rem;
    font-family: inherit;
    font-size: inherit;
    color: inherit;
    background: transparent;
    box-sizing: border-box;
  }

  .field-input:focus {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
  }

  .button-group {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  #membersContainer :global(.member-section) {
    border: 1px solid var(--color-highlight);
    border-radius: 0.5rem;
    padding: 1.25rem 1.25rem 1rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin: 0;
  }

  #membersContainer :global(.member-section + .member-section) {
    margin-top: 1.25rem;
  }

  #membersContainer :global(.member-legend) {
    font-family: "HomemadeApple", cursive;
    font-size: 1rem;
    color: var(--color-heading);
    padding: 0 0.25rem;
  }

  #membersContainer :global(.field) {
    display: block;
  }

  #membersContainer :global(.field-label) {
    display: block;
    margin-bottom: 0.35rem;
    font-family: "Lanenar", sans-serif;
  }

  #membersContainer :global(.field-input) {
    width: 100%;
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--color-border);
    border-radius: 0.5rem;
    font-family: inherit;
    font-size: inherit;
    color: inherit;
    background: transparent;
    box-sizing: border-box;
  }

  #membersContainer :global(.field-input:focus) {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
  }

  .rsvp-meta {
    font-size: 0.85rem;
    color: var(--color-heading);
    opacity: 0.75;
  }

  .explore-nudge {
    margin-top: 2rem;
    padding: 1.25rem;
    border: 1px solid var(--color-highlight);
    border-radius: 0.5rem;
    background: hsla(340, 60%, 75%, 0.08);
    text-align: center;
  }

  .explore-nudge p {
    font-family: "Lanenar", sans-serif;
    margin-bottom: 0.75rem;
  }

  .explore-subtle {
    margin-top: 2.5rem;
    text-align: center;
    opacity: 0.7;
  }

  .explore-subtle p {
    font-size: 0.85rem;
    margin-bottom: 0.5rem;
  }

  .explore-links {
    display: flex;
    justify-content: center;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .explore-links a {
    font-family: "HomemadeApple", cursive;
    color: var(--color-accent, #C66623);
    text-decoration: none;
    padding: 0.4rem 0.8rem;
    border: 1px solid var(--color-accent, #C66623);
    border-radius: 999px;
    font-size: 0.85rem;
    transition: transform 120ms ease, background 120ms ease, color 120ms ease;
  }

  .explore-links a:hover,
  .explore-links a:focus-visible {
    transform: translateY(-1px);
    background: var(--color-accent, #C66623);
    color: white;
  }
</style>
