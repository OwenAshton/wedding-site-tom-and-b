---
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Signing you in…</title>
  </head>
  <body class="p-6">
    <p id="msg">Signing you in…</p>

    <script type="module">
      import { supabase } from "../../lib/supabaseClient";

      const msg = document.getElementById("msg");

      (async () => {
        const url = new URL(window.location.href);
        const code = url.searchParams.get("code");

        try {
          if (!code) {
            window.location.replace("/login-error");
            return;
          }

          const { error } = await supabase.auth.exchangeCodeForSession(code);
          if (error) {
            window.location.replace("/login-error");
            return;
          }

          const { data } = await supabase.auth.getSession();
          if (!data.session) {
            window.location.replace("/login-error");
            return;
          }

          window.location.replace("/guard");
        } catch (err) {
          msg.textContent = `Sign-in error: ${err?.message ?? err}`;
          // Optional: redirect after a short delay, or immediately:
          window.location.replace("/login-error");
        }
      })();
    </script>
  </body>
</html>
